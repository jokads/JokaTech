import{a as k,r as i,j as e}from"./index-C0IYKngZ.js";import{N as O,F as C}from"./Footer-BDjK8bl0.js";function A(){const j=k(),[n,w]=i.useState([]),[o,f]=i.useState(!1),[N,y]=i.useState(""),[s,E]=i.useState({fullName:"",email:"",phone:"",address:"",city:"",postalCode:"",country:"Luxembourg"});i.useEffect(()=>{const a=JSON.parse(localStorage.getItem("cart")||"[]");a.length===0&&j("/carrinho"),w(a)},[j]);const t=a=>{E({...s,[a.target.name]:a.target.value})},m=n.reduce((a,l)=>a+l.price*l.quantity,0),x=m>100?0:9.99,p=m+x,S=async a=>{a.preventDefault(),f(!0),y("");try{if(console.log("üöÄ Iniciando processo de pagamento..."),!s.fullName||!s.email||!s.phone||!s.address||!s.city||!s.postalCode)throw new Error("Por favor, preencha todos os campos obrigat√≥rios.");if(n.length===0)throw new Error("Seu carrinho est√° vazio.");console.log("‚úÖ Valida√ß√£o conclu√≠da"),console.log("üì¶ Itens no carrinho:",n.length);const l={items:n.map(r=>({name:r.name,description:r.description||"",price:Math.round(r.price*100),quantity:r.quantity,image:r.image_url})),customerInfo:{name:s.fullName,email:s.email,phone:s.phone,address:`${s.address}, ${s.city}, ${s.postalCode}, ${s.country}`},successUrl:`${window.location.origin}/sucesso?session_id={CHECKOUT_SESSION_ID}`,cancelUrl:`${window.location.origin}/carrinho`};console.log("üí≥ Criando sess√£o de pagamento Stripe..."),console.log("üìä Total do pedido: ‚Ç¨"+p.toFixed(2));const u="https://srxhdwnnkddsfclizqoo.supabase.co",v="sb_publishable_HrWVsabIrHMm5UP4SrGH-g_oQqZjMTE";console.log("üì° Enviando requisi√ß√£o para:",`${u}/functions/v1/create-stripe-checkout`);const d=await fetch(`${u}/functions/v1/create-stripe-checkout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify(l)});if(console.log("üì° Resposta do servidor:",d.status,d.statusText),!d.ok){const r=await d.text();console.error("‚ùå Erro na resposta:",r);let c="Erro ao processar pagamento. Tente novamente.";try{const g=JSON.parse(r);c=g.error||g.message||c}catch{c=`Erro no servidor (${d.status}). Entre em contato com o suporte via WhatsApp.`}throw new Error(c)}const b=await d.json();console.log("üì• Dados recebidos:",b);const{url:h}=b;if(!h)throw console.error("‚ùå URL de pagamento n√£o retornada"),console.error("üì• Resposta completa:",JSON.stringify(b,null,2)),new Error("URL de pagamento n√£o foi retornada. Entre em contato com o suporte via WhatsApp.");console.log("‚úÖ URL de pagamento recebida:",h),localStorage.setItem("pendingOrder",JSON.stringify({customer_name:s.fullName,customer_email:s.email,customer_phone:s.phone,shipping_address:`${s.address}, ${s.city}, ${s.postalCode}, ${s.country}`,total_amount:p,items:n,created_at:new Date().toISOString()})),console.log("üíæ Pedido salvo localmente"),localStorage.removeItem("cart"),window.dispatchEvent(new Event("storage")),console.log("üîÑ Redirecionando para Stripe..."),window.location.href=h}catch(l){console.error("üí• Erro ao processar pagamento:",l),y(l.message||"Erro ao processar pagamento. Por favor, tente novamente ou entre em contato conosco via WhatsApp: +352 XXX XXX XXX"),f(!1)}};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx(O,{}),e.jsx("div",{className:"pt-24 pb-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[e.jsxs("h1",{className:"text-5xl font-bold text-black mb-8",children:["FINALIZAR ",e.jsx("span",{className:"text-gold",children:"COMPRA"})]}),N&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"ri-error-warning-line text-xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:"Erro ao processar pagamento"}),e.jsx("p",{className:"text-sm",children:N})]})]})}),e.jsx("form",{onSubmit:S,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-black mb-6",children:"INFORMA√á√ïES DE ENTREGA"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"NOME COMPLETO *"}),e.jsx("input",{type:"text",name:"fullName",value:s.fullName,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",placeholder:"Seu nome completo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"E-MAIL *"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",placeholder:"seu@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"TELEFONE *"}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",placeholder:"+352 XXX XXX XXX"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"ENDERE√áO *"}),e.jsx("input",{type:"text",name:"address",value:s.address,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",placeholder:"Rua, n√∫mero, apartamento"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"CIDADE *"}),e.jsx("input",{type:"text",name:"city",value:s.city,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",placeholder:"Cidade"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"C√ìDIGO POSTAL *"}),e.jsx("input",{type:"text",name:"postalCode",value:s.postalCode,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",placeholder:"L-XXXX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"PA√çS *"}),e.jsxs("select",{name:"country",value:s.country,onChange:t,required:!0,disabled:o,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-gold disabled:opacity-50",children:[e.jsx("option",{value:"Luxembourg",children:"Luxembourg"}),e.jsx("option",{value:"France",children:"France"}),e.jsx("option",{value:"Belgium",children:"Belgium"}),e.jsx("option",{value:"Netherlands",children:"Netherlands"}),e.jsx("option",{value:"Germany",children:"Germany"}),e.jsx("option",{value:"Italy",children:"Italy"}),e.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),e.jsx("option",{value:"Sweden",children:"Sweden"})]})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 sticky top-24",children:[e.jsx("h2",{className:"text-2xl font-bold text-black mb-6",children:"RESUMO DO PEDIDO"}),e.jsx("div",{className:"space-y-4 mb-6 max-h-64 overflow-y-auto",children:n.map(a=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded overflow-hidden flex-shrink-0",children:e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-contain p-1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-black line-clamp-1",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Qtd: ",a.quantity]})]}),e.jsxs("p",{className:"text-sm font-bold text-black",children:["‚Ç¨",(a.price*a.quantity).toFixed(2)]})]},a.id))}),e.jsxs("div",{className:"space-y-3 mb-6 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["‚Ç¨",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Envio"}),e.jsx("span",{className:"font-semibold",children:x===0?"GR√ÅTIS":`‚Ç¨${x.toFixed(2)}`})]}),e.jsxs("div",{className:"border-t pt-3 flex justify-between text-xl font-bold text-black",children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{children:["‚Ç¨",p.toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full px-6 py-4 bg-gold text-black font-bold rounded-lg hover:bg-gold-dark transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed mb-4 whitespace-nowrap flex items-center justify-center space-x-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"PROCESSANDO..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-shopping-bag-3-line text-xl"}),e.jsx("span",{children:"FINALIZAR COMPRA"})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-black mb-2",children:"PAGAMENTO 100% SEGURO"}),e.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-3",children:[e.jsx("i",{className:"ri-visa-line text-3xl text-gray-700"}),e.jsx("i",{className:"ri-mastercard-line text-3xl text-gray-700"}),e.jsx("div",{className:"px-2 py-1 bg-gray-200 rounded text-xs font-bold text-gray-700",children:"STRIPE"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"üîí Seus dados est√£o protegidos com criptografia SSL"}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"üí≥ Pagamento processado via Stripe"})]})]})})]})})]})}),e.jsx(C,{})]})}export{A as default};
//# sourceMappingURL=page-C58ofZtB.js.map
